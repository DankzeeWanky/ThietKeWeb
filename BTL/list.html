<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="DefaultWithTitle.css">
        <style>

            .filters {
                display: flex;
                gap: 10px;
                margin-bottom: 20px;
            }

            select {
                background-color: #123C69;
                color: white;
                border: none;
                padding: 8px 14px;
                margin-left: 20px;
                font-size: 14px;
                text-align: center;
                text-align-last: center;
                cursor: pointer;
                appearance: none;
            }

            .job-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 20px;
            }

            .job-card {
                background-color: #EEE2DC;
                border-radius: 10px;
                padding: 10px;
                text-align: center;
            }

            .job-image {
                width: 80px;
                height: 80px;
                margin: 0 auto 10px;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
            }

            .job-title {
                font-weight: bold;
            }

            .job-company {
                font-size: 12px;
                color: gray;
            }

        </style>
    </head>
    <body>

        <div class="header">
            <img src="images/logo.png" class="logo" alt="Logo">
            <h1>TRENDING JOBS</h1>
            <div class="dropdown">
                <button class="dropdown-toggle" id="dropdownBtn"></button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="resume.html"><button>Upload your CV</button></a>
                    <hr />
                    <a href="mainmenu.html">Main Menu</a>
                    <a href="list.html">Trending Jobs</a>
                    <a href="contact.html">About Us</a>
                </div>
            </div>
        </div>

        <div class="filters">
            <select id="typeSelect">
                <option value="">Type ▼</option>
            </select>
            <select id="salarySelect">
                <option value="">Salary ▼</option>
            </select>
            <select id="locationSelect">
                <option value="">Location ▼</option>
            </select>
        </div>

        <div class="job-grid" id="jobGrid"></div>

        <div class="footer">
            <div class="social-icons">
                <a href="https://www.facebook.com/" target="_blank">
                    <img src="images/facebook.png" alt="Facebook">
                </a>
                <a href="https://www.instagram.com/" target="_blank">
                    <img src="images/instagram.png" alt="Instagram">
                </a>
                <a href="https://www.youtube.com/" target="_blank">
                    <img src="images/youtube.png" alt="YouTube">
                </a>
                <a href="https://x.com/" target="_blank">
                    <img src="images/twitter.png" alt="Twitter">
                </a>
            </div>
            <div class="copyright">
                Copyright 2023 all rights Flowgiri reserved
            </div>
        </div>

        <script>
            const salaryRanges = [
                { label: "$30,000 - $48,000", min: 30000, max: 48000 },
                { label: "$48,000 - $69,000", min: 48000, max: 69000 },
                { label: "$69,000 - $87,000", min: 69000, max: 87000 },
                { label: "$87,000 - $105,000", min: 87000, max: 105000 },
                { label: "$105,000 - $119,000", min: 105000, max: 119000 }
            ];

            let jobs = [];
            let filteredJobs = [];

            fetch('dataset.json')
                .then(res => res.json())
                .then(data => {
                jobs = data;
                filteredJobs = [...jobs];
                populateDropdowns();
                renderJobs(filteredJobs);
                });

            function populateDropdowns() {
                const typeSelect = document.getElementById('typeSelect');
                const locationSelect = document.getElementById('locationSelect');
                const salarySelect = document.getElementById('salarySelect');

                [...new Set(jobs.map(job => job.type))].filter(Boolean).sort()
                .forEach(type => {
                    let opt = document.createElement('option');
                    opt.value = type;
                    opt.textContent = type;
                    typeSelect.appendChild(opt);
                });

                salaryRanges.forEach((range, idx) => {
                let opt = document.createElement('option');
                opt.value = idx;
                opt.textContent = range.label;
                salarySelect.appendChild(opt);
                });

                [...new Set(jobs.map(job => job.location))].sort()
                .forEach(location => {
                    let opt = document.createElement('option');
                    opt.value = location;
                    opt.textContent = location;
                    locationSelect.appendChild(opt);
                });
            }

            function renderJobs(jobList) {
            const grid = document.getElementById('jobGrid');
            grid.innerHTML = '';

            jobList.forEach(job => {
                const imgUrl = `${job.company_name}.png`;

                const card = document.createElement('div');
                card.classList.add('job-card');
                card.innerHTML = `
                <div class="job-image" style="background-image: url('images/${imgUrl}');"></div>
                <div class="job-title">${job.job_name}</div>
                <div class="job-company">${job.company_name}</div>
                `;

                card.addEventListener('click', () => openDetails(job));

                card.setAttribute('role', 'button');
                card.tabIndex = 0;
                card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openDetails(job);
                }
                });

                grid.appendChild(card);
            });
            }

            function openDetails(job) {
                try {
                    localStorage.setItem('selectedJob', JSON.stringify(job));
                } catch (e) {
                    console.warn('Could not save job to localStorage:', e);
                }
                window.location.href = 'detail.html';
            }

            document.getElementById('typeSelect').addEventListener('change', filterJobs);
            document.getElementById('salarySelect').addEventListener('change', filterJobs);
            document.getElementById('locationSelect').addEventListener('change', filterJobs);

            function filterJobs() {
                const selectedType = document.getElementById('typeSelect').value;
                const selectedSalaryIndex = document.getElementById('salarySelect').value;
                const selectedLocation = document.getElementById('locationSelect').value;

                filteredJobs = jobs.filter(job => {
                let matchType = selectedType ? job.type === selectedType : true;
                let matchSalary = true;
                let matchLocation = selectedLocation ? job.location === selectedLocation : true;

                if (selectedSalaryIndex !== "") {
                    const salaryValue = parseFloat(job.salary.replace(/[^0-9.]/g, ''));
                    const range = salaryRanges[selectedSalaryIndex];
                    matchSalary = salaryValue >= range.min && salaryValue <= range.max;
                }

                return matchType && matchSalary && matchLocation;
                });

                renderJobs(filteredJobs);
            }
        </script>
        <script src="mainscript.js"></script>

    </body>
</html>
